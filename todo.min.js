YUI().add("todo-app",function(e){var f=e.ToDo;var b=f.Item;var c=f.List;var d=f.ItemView;var a=function(h){h.container=h.container||"#todo-app";h.inputNode=h.inputNode||"#new-todo";h.list=h.list||"#todo-list";h.stats=h.stats||"#todo-stats";var i={".todo-clear":{click:"clearDone"},".todo-item":{mouseover:"hoverOn",mouseout:"hoverOff"}};i[h.inputNode]={keypress:"createTodo"};var g=e.Base.create("todoApp",e.View,[],{container:e.one(h.container),inputNode:e.one(h.inputNode),template:e.one("#todo-stats-template").getContent(),events:i,initializer:function(){var j=this.todoList=new c();j.after("add",this.add,this);j.after("reset",this.reset,this);j.after(["add","reset","remove","item:doneChange"],this.render,this);j.load();},render:function(){var m=this.todoList;var l=e.one(h.stats);var k;var j;if(m.isEmpty()){l.empty();return this;}j=m.done().length;k=m.remaining().length;l.setContent(e.Lang.sub(this.template,{numDone:j,numRemaining:k,doneLabel:j===1?"task":"tasks",remainingLabel:k===1?"task":"tasks"}));if(!j){l.one(".todo-clear").remove();}return this;},add:function(k){var j=new d({model:k.model});e.one(h.list).append(j.render().container);},clearDone:function(k){var j=this.todoList.done();k.preventDefault();this.todoList.remove(j,{silent:true});e.Array.each(j,function(l){l.destroy({"delete":true});});this.render();},createTodo:function(k){var j;if(k.keyCode===13){j=e.Lang.trim(this.inputNode.get("value"));if(!j){return;}this.todoList.create({text:j});this.inputNode.set("value","");}},hoverOff:function(j){j.currentTarget.removeClass("todo-hover");},hoverOn:function(j){j.currentTarget.addClass("todo-hover");},reset:function(k){var j=e.one(e.config.doc.createDocumentFragment());e.Array.each(k.models,function(m){var l=new d({model:m});j.append(l.render().container);});e.one(h.list).setContent(j);}});return new g();};e.namespace("ToDo").App=a;},"0.0.1",{requires:["view","event-focus","todo-storage","todo-item","todo-list","todo-item-view"]});YUI.add("todo-item",function(c){var b=c.ToDo.LocalStorage;var a=c.Base.create("item",c.Model,[],{sync:b("todo"),toggleDone:function(){this.set("done",!this.get("done")).save();}},{ATTRS:{done:{value:false},text:{value:""}}});c.namespace("ToDo").Item=a;},"0.0.1",{requires:["model","todo-storage"]});YUI.add("todo-list",function(d){var b=d.ToDo.LocalStorage;var a=d.ToDo.Item;var c=d.Base.create("list",d.ModelList,[],{model:a,sync:b("todo"),done:function(){return d.Array.filter(this.toArray(),function(e){return e.get("done");});},remaining:function(){return d.Array.filter(this.toArray(),function(e){return !e.get("done");});}});d.namespace("ToDo").List=c;},"0.0.1",{requires:["model-list"]});YUI().add("todo-storage",function(b){var a=function(g){var e;if(!g){b.error("No storage key specified.");}if(b.config.win.localStorage){e=b.config.win.localStorage;}var i=b.JSON.parse((e&&e.getItem(g))||"{}");function f(l){var k;if((k=i[l])){delete i[l];h();}return k;}function c(){var l="";var k=4;while(k--){l+=(((1+Math.random())*65536)|0).toString(16).toString(1);}return l;}function d(k){return k?i[k]:b.Object.values(i);}function h(){e&&e.setItem(g,b.JSON.stringify(i));}function j(k){var m=k.toJSON();var l=k.idAttribute;if(!b.Lang.isValue(m[l])){m[l]=c();}i[m[l]]=m;h();return m;}return function(m,k,n){var l=b.Model&&this instanceof b.Model;switch(m){case"create":case"update":n(null,j(this));return;case"read":n(null,d(l&&this.get("id")));return;case"delete":n(null,f(l&&this.get("id")));return;}};};b.namespace("ToDo").LocalStorage=a;},"0.0.1",{requires:["json","model"]});YUI().add("todo-item-view",function(b){var a=b.Base.create("itemView",b.View,[],{container:'<li class="todo-item" />',template:b.one("#todo-item-template").getContent(),events:{".todo-checkbox":{click:"toggleDone"},".todo-content":{click:"edit",focus:"edit"},".todo-input":{blur:"save",keypress:"enter"},".todo-remove":{click:"remove"}},initializer:function(){var c=this.model;c.after("change",this.render,this);c.after("destroy",this.destroy,this);},render:function(){var d=this.container;var e=this.model;var c=e.get("done");d.setContent(b.Lang.sub(this.template,{checked:c?"checked":"",text:e.getAsHTML("text")}));d[c?"addClass":"removeClass"]("todo-done");this.inputNode=d.one(".todo-input");return this;},edit:function(){this.container.addClass("editing");this.inputNode.focus();},enter:function(c){if(c.keyCode===13){b.one("#new-todo").focus();}},remove:function(c){c.preventDefault();this.constructor.superclass.remove.call(this);this.model.destroy({"delete":true});},save:function(){this.container.removeClass("editing");this.model.set("text",this.inputNode.get("value")).save();},toggleDone:function(){this.model.toggleDone();}});b.namespace("ToDo").ItemView=a;},"0.0.1",{requires:["view","event-focus"]});